---
- hosts: all
  gather_facts: False

- hosts: appnode
  remote_user: root

  tasks:
    - name: Install gpg key for Neo4j
      rpm_key:
        state: present
        key: http://debian.neo4j.org/neotechnology.gpg.key

    - name: Add Neo4j Repo to yum.repos.d
      copy:
        src: /cheevos/deployment/appnode/filesToCopy/neo4j.repo
        dest: /etc/yum.repos.d/

    - name: Install Neo4j (yum)
      yum:
        name: neo4j-3.2.2
        state: latest

    - name: Copy Neo4j Configuration
      copy:
        src: /cheevos/deployment/appnode/filesToCopy/neo4j.conf
        dest: /etc/neo4j

#    - name: Set initial password
#      command: neo4j-admin set-initial-password "test"
#      args:
#        creates: /var/lib/neo4j/data/dbms/auth

    - name: Enable Neo4j on boot (systemctl)
      systemd:
        name: neo4j
        enabled: yes

    - name: Start Neo4j service (systemctl)
      systemd:
        name: neo4j
        state: started

